#include "LCD12864.h"

uchar code table_week[12]={0,3,3,6,1,4,6,2,5,0,3,5};
uchar Fanflag=0;//风扇标志位




//===================字体1==========================
/************************************************************************************/
unsigned char code num16321[11][64]={	
{// 图片数字0
0x00,0x00,0x3F,0xFC,0x5F,0xFA,0x6F,0xF6,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,
0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x60,0x06,0x40,0x02,0x00,0x00,
0x40,0x02,0x60,0x06,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,
0x70,0x0E,0x70,0x0E,0x70,0x0E,0x6F,0xF6,0x5F,0xFA,0x3F,0xFC,0x00,0x00,0x00,0x00},	
{// 图片数字1
0x00,0x00,0x00,0x20,0x00,0x60,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,
0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0x60,0x00,0x20,0x00,0x00,0x00,0x20,
0x00,0x60,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,
0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0x60,0x00,0x20,0x00,0x00,0x00,0x00,0x00,0x00},
{// 图片数字2
0x00,0x00,0x3F,0xFC,0x1F,0xFA,0x0F,0xF6,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,
0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x06,0x1F,0xFA,0x3F,0xFC,
0x5F,0xF8,0x60,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,
0x70,0x00,0x70,0x00,0x70,0x00,0x6F,0xF8,0x5F,0xFC,0x3F,0xFE,0x00,0x00,0x00,0x00},	
{// 图片数字3
0x00,0x00,0x3F,0xFC,0x1F,0xFA,0x0F,0xF6,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,
0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x06,0x1F,0xFA,0x3F,0xFC,
0x1F,0xFA,0x00,0x06,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,
0x00,0x0E,0x00,0x0E,0x00,0x0E,0x0F,0xF6,0x1F,0xFA,0x3F,0xFC,0x00,0x00,0x00,0x00},	
{// 图片数字4
0x00,0x00,0x40,0x02,0x60,0x06,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,
0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x60,0x06,0x5F,0xFA,0x3F,0xFC,
0x1F,0xFA,0x00,0x06,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,
0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x06,0x00,0x02,0x00,0x00,0x00,0x00},	
{// 图片数字5
0x00,0x00,0x3F,0xFC,0x5F,0xF8,0x6F,0xF0,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,
0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x60,0x00,0x5F,0xF8,0x3F,0xFC,
0x1F,0xFA,0x00,0x06,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,
0x00,0x0E,0x00,0x0E,0x00,0x0E,0x0F,0xF6,0x1F,0xFA,0x3F,0xFC,0x00,0x00,0x00,0x00},	
{// 图片数字6
0x00,0x00,0x3F,0xFC,0x5F,0xF8,0x6F,0xF0,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,
0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x60,0x00,0x5F,0xF8,0x3F,0xFC,
0x5F,0xFA,0x60,0x06,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,
0x70,0x0E,0x70,0x0E,0x70,0x0E,0x6F,0xF6,0x5F,0xFA,0x3F,0xFC,0x00,0x00,0x00,0x00},	
{// 图片数字7
0x00,0x00,0x3F,0xFC,0x1F,0xFA,0x0F,0xF6,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,
0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x06,0x00,0x02,0x00,0x00,
0x00,0x02,0x00,0x06,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,
0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x06,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00},
{// 图片数字8
0x00,0x00,0x3F,0xFC,0x5F,0xFA,0x6F,0xF6,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,
0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x60,0x06,0x5F,0xFA,0x3F,0xFC,
0x5F,0xFA,0x60,0x06,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,
0x70,0x0E,0x70,0x0E,0x70,0x0E,0x6F,0xF6,0x5F,0xFA,0x3F,0xFC,0x00,0x00,0x00,0x00},	
{// 图片数字9
0x00,0x00,0x3F,0xFC,0x5F,0xFA,0x6F,0xF6,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,
0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x60,0x06,0x5F,0xFA,0x3F,0xFC,
0x1F,0xFA,0x00,0x06,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,
0x00,0x0E,0x00,0x0E,0x00,0x0E,0x1F,0xF6,0x3F,0xFA,0x7F,0xFC,0x00,0x00,0x00,0x00},	
{// 图片":"	10
//6X6方点
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0xE0,0x07,0xE0,
0x07,0xE0,0x07,0xE0,0x07,0xE0,0x07,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0xE0,0x07,0xE0,0x07,0xE0,0x07,0xE0,
0x07,0xE0,0x07,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}
};

uchar code kong3216[]={
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0xE0,0x07,0xE0,
0x07,0xE0,0x07,0xE0,0x07,0xE0,0x07,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0xE0,0x07,0xE0,0x07,0xE0,0x07,0xE0,
0x07,0xE0,0x07,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

uchar code wd[]={0x00,0x00,0x30,0x00,0x48,0x00,0x49,0xC0,0x33,0xE8,0x06,0x38,0x0C,0x18,0x0C,0x08,
0x0C,0x00,0x0C,0x00,0x0C,0x00,0x0C,0x00,0x06,0x08,0x03,0x10,0x01,0xE0,0x00,0x00}; //"℃"    
uchar code wdj[]=
{0x00,0x00,0x01,0x80,0x02,0x40,0x02,0x40,0x02,0xC0,0x02,0x40,0x02,0xC0,0x02,0x40,
0x02,0xC0,0x02,0x40,0x03,0xC0,0x07,0xE0,0x0F,0xF0,0x0F,0xF0,0x07,0xE0,0x03,0xC0};	//温度计图标

uchar code fan[]={
0X00,0X00,0X03,0XC0,0X08,0X10,0X03,0X00,0X13,0X88,0X00,0X00,0X01,0XF0,0X07,0X70,
0X16,0X08,0X06,0X00,0X04,0X20,0X01,0X80,0X00,0X00,0X03,0XC0,0X07,0XE0,0X00,0X00,
};



void ClearScreen(void)
{
	uchar i,j;
	lcd_wcmd(0x34);
	for(i=0;i<32;i++)
	{
		
		lcd_wcmd(0x80+i);
		lcd_wcmd(0x80);
		for(j=0;j<32;j++)
		lcd_wdat(0x00);	
	}
}


/*******************************************************************/
/*                                                                 */
/*检查LCD忙状态                                                    */
/*lcd_busy为1时，忙，等待。lcd-busy为0时,闲，可写指令与数据。      */
/*                                                                 */
/*******************************************************************/
void busy()
{
   LCD_RS=0; LCD_RW=1; LCD_EN=1;
   P1=0xff;
   while((P1&0x80)==0x80);
   LCD_EN=0;
}
/*******************************************************************/
/*                                                                 */
/*写指令数据到LCD                                                  */
/*RS=L，RW=L，E=高脉冲，D0-D7=指令码。                             */
/*                                                                 */
/*******************************************************************/
void lcd_wcmd(uchar cmd)
{                          
    busy();
    LCD_RS=0;
    LCD_RW=0;
    LCD_EN=0;
    P1=cmd;
    delayNOP();
    LCD_EN=1;
    delayNOP();
    LCD_EN=0;  
}
/*******************************************************************/
/*                                                                 */
/*写显示数据到LCD                                                  */
/*RS=H，RW=L，E=高脉冲，D0-D7=数据。                               */
/*                                                                 */
/*******************************************************************/
void lcd_wdat(uchar dat)
{                          
    busy();
    LCD_RS=1;
    LCD_RW=0;
    LCD_EN=0;
    P1=dat;
    delayNOP();
    LCD_EN=1;
    delayNOP();
    LCD_EN=0; 
}
/*******************************************************************/
/*                                                                 */
/*  LCD初始化设定                                                  */
/*                                                                 */
/*******************************************************************/
void lcd_init()
{ 
    
    lcd_wcmd(0x30);      
    LCD_Delay(5);      //重复操作，因为该单片机运行速度较快@22.1184MHz
  
	lcd_wcmd(0x02);      
    LCD_Delay(5);


	lcd_wcmd(0x0C);      
    LCD_Delay(5);

	lcd_wcmd(0x06);      
    LCD_Delay(5);

	lcd_wcmd(0x01);      
    LCD_Delay(5);			
}

/*******************************************
函数名称:Draw_PM
功    能:在整个液晶屏幕上画图
参    数:无
返回值  :无
********************************************/
//void Draw_PM(const uchar *ptr)
//{
//    uchar i,j,k;
//	lcd_wcmd(0x34);        //打开扩展指令集
//	i = 0x80;            
//	for(j = 0;j < 32;j++)
//	{
//        lcd_wcmd(i++);
//        lcd_wcmd(0x80);
//  		for(k = 0;k < 16;k++)
//  		{
//  		    lcd_wdat(*ptr++);
//  		}
//	}
//	i = 0x80;
// 	for(j = 0;j < 32;j++)
//	{
// 	    lcd_wcmd(i++);
//        lcd_wcmd(0x88);  
//  		for(k = 0;k < 16;k++)
//  		{
//   		    lcd_wdat(*ptr++);
//   		} 
//	}  
//    lcd_wcmd(0x36); 	  //打开绘图显示     
//	lcd_wcmd(0x30);        //回到基本指令集
//}

void displayDigital_12864(uchar y,uchar x,uchar shu)
{
 	uchar a,b,Address;
	a=shu/10;
	b=shu%10;
 	if(y==1){Address=0x80+x;} 	      //Y判断第几行,X判断第几列,0x80为液晶行初始地址
 	if(y==2){Address=0x90+x;} 	   
 	if(y==3){Address=0x88+x;} 
 	if(y==4){Address=0x98+x;} 
	lcd_wcmd(Address);	          //写入地址命令到LCD12864
	lcd_wdat(0x30+a);
	lcd_wdat(0x30+b);

}

void display_12864(uchar y,uchar x,uchar *z)
{ 
 	uchar Address;
 	if(y==1){Address=0x80+x;} 	          //Y判断第几行,X判断第几列,0x80为液晶行初始地址
 	if(y==2){Address=0x90+x;} 	   
 	if(y==3){Address=0x88+x;} 
 	if(y==4){Address=0x98+x;} 
	lcd_wcmd(Address);	          //写入地址命令到LCD12864	
	while(*z!='\0')					      //写入显示数据的大小
	{		
 		lcd_wdat(*z++); 	          //写入显示数据到LCD12864					  
	}  
}



void displaypicture_12864(uchar y,uchar x,uchar *picture,uchar hight,uchar wide)
{
	uchar line,row;
	lcd_wcmd(0x36);
	if(wide%8==0)
		wide=wide/8;
	else
		wide=wide/8+1;
	for(line=0;line<hight;line++)
	{
		if(y+line>31)
		{
			lcd_wcmd(0x80+y+line-32);
			lcd_wcmd(0x80+x+8);	
	
		}
		else
		{
			lcd_wcmd(0x80+y+line);
			lcd_wcmd(0x80+x);
		}
		for(row=0;row<wide;row++)
		{
			lcd_wdat(picture[line*wide+row]);
		}
	}
	lcd_wcmd(0x30);
}
extern uchar sfm[14];
void DisplayTime()
{
		uchar Str[40];
		uchar a,Year,Month,Day,temp;
		temp=ReadTemperature();
		
		displaypicture_12864(16,0,num16321[sfm[8]],32,16);
		displaypicture_12864(16,1,num16321[sfm[9]],32,16);//时
	
			
		displaypicture_12864(16,3,num16321[sfm[10]],32,16);//分
		displaypicture_12864(16,4,num16321[sfm[11]],32,16);
		
		displaypicture_12864(16,6,num16321[sfm[12]],32,16); 
		displaypicture_12864(16,7,num16321[sfm[13]],32,16); //秒
		
		displaypicture_12864(17,2,num16321[10],32,16);
		displaypicture_12864(17,5,num16321[10],32,16);
		//displaypicture_12864(17,2,kong3216,32,16);
		//displaypicture_12864(17,5,kong3216,32,16);
		
	    if(sfm[10]==0&&sfm[11]==0&&sfm[12]==0&&sfm[13]==0)
		{
			 sprintf(Str,"现在时间%d整",sfm[8]+sfm[9]);
			 SYN_FrameInfo(0,Str);
		}
		if(Fanflag==0||Fanflag==4) {read_time();display_12864(4,1,"关闭");}
		if(Fanflag==1) {read_time();display_12864(4,1,"打开"); }
		if(Fanflag==2) {read_time();display_12864(4,1,"高速");}
		if(Fanflag==3) {read_time();display_12864(4,1,"低速");}
		if(Fanflag==5) {read_time();display_12864(4,1,"Wait");}	
		
		
		displaypicture_12864(48,0,fan,16,16);//风扇图标
		displaypicture_12864(48,4,wdj,16,16);//摄氏度
		displaypicture_12864(48,7,wd,16,16);//温度	

		Year=sfm[0]*10+sfm[1];
		Month=sfm[4]*10+sfm[5];
		Day=sfm[6]*10+sfm[7];
		a=Conver_week(Year,Month,Day);
	    displayDigital_12864(1,0,20);
	    displayDigital_12864(1,1,Year);//显示年
	    lcd_wdat('-');//显示‘-’
	    lcd_wdat(Month/10+0x30);
		lcd_wdat(Month%10+0x30);//显示月
		lcd_wdat('-');	
		displayDigital_12864(1,4,Day);

		switch(a)
		{
			case 0:{display_12864(1,6,"周日");} break; //0=星期日
			case 1:{display_12864(1,6,"周一");}break;
			case 2:{display_12864(1,6,"周二");}break;
			case 3:{display_12864(1,6,"周三");}break;
			case 4:{display_12864(1,6,"周四");}break;
			case 5:{display_12864(1,6,"周五");}break;
			case 6:{display_12864(1,6,"周六");}break;
			default:break;
		}
		lcd_wcmd(0x98+5);
		lcd_wdat(temp%1000/100+0x30);
		lcd_wdat(temp%100/10+0x30 );
		lcd_wdat('.');
		lcd_wdat(temp%10+0x30);
}




